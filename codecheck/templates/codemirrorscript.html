<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/python-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closebrackets.min.js"></script>
<script>
    window.onload = function() {
        var textarea = document.getElementById("editor");
        if (!textarea) {
            console.error("Textarea with id 'editor' not found!");
            return;
        }

        // Initialize CodeMirror
        var editor = CodeMirror.fromTextArea(textarea, {
            mode: "python",
            theme: "eclipse",
            lineNumbers: true,
            tabSize: 2,
            indentWithTabs: true,
            autoCloseBrackets: {
                pairs: "[](){}''\"\"<>",
                triples: "'''\"\"\"",
                explode: "[]{}()"
            },
            extraKeys: {
                "Ctrl-Space": "autocomplete"
            }
        });

        // Ensure textarea gets updated before form submission
        document.querySelector("form").onsubmit = function() {
            textarea.value = editor.getValue();
            console.log("Submitting:", textarea.value);  // Debugging output
        };
    };
</script>
